name: CI

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v2

      - name: Print docker version
        run: |
          docker -v
          docker-compose -v

      # https://github.com/actions/virtual-environments/issues/765
      - name: Run docker-compose
        run: |
          echo "JWT_SECRET=${{ secrets.DEPLOY_JWT_SECRET }}" >> .env
          echo "PORT=${{ secrets.DEPLOY_PORT }}" >> .env
          docker-compose build
          docker-compose up -d

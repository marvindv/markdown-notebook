name: CI

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v2

      - name: Print docker version
        run: |
          docker -v
          docker-compose -v

      # https://github.com/actions/virtual-environments/issues/765
      - name: Run docker-compose
        run: |
          JWT_SECRET=${{ secrets.DEPLOY_JWT_SECRET }} PORT=${{ secrets.DEPLOY_PORT }} DATABASE_STORAGE_DIR=${{ secrets.DEPLOY_DATABASE_STORAGE_DIR }} docker-compose build
          JWT_SECRET=${{ secrets.DEPLOY_JWT_SECRET }} PORT=${{ secrets.DEPLOY_PORT }} DATABASE_STORAGE_DIR=${{ secrets.DEPLOY_DATABASE_STORAGE_DIR }} docker-compose up -d
